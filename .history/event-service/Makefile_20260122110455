.PHONY: proto

include .env
export
DB_URL=postgres://${DB_USER}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_DATABASE}?sslmode=${DB_SSLMODE}
MIGRATION_DIR := $(CURDIR)/migrations

PROTO_DIR=proto
GOOGLEAPIS_DIR=googleapis

migration-create:
	@mkdir -p $(MIGRATION_DIR)
	@goose -dir $(MIGRATION_DIR) create $(name) sql

migration-up:
	migrate -database "$(DB_URL)" -path ./pkg/database/gorm/migrations up

proto:
	protoc \
		-I $(PROTO_DIR) \
		-I $(GOOGLEAPIS_DIR) \
		--go_out=. \
		--go-grpc_out=. \
		--grpc-gateway_out=. \
		--openapiv2_out=$(PROTO_DIR) \
		$(PROTO_DIR)/event.proto